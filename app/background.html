<h1>Background</h1>

<script type="text/javascript">
	const {
		ipcRenderer
	} = require('electron');
	const {
		PythonShell
	} = require('python-shell');
	require('../node_modules/log4js/lib/appenders/stdout');
	require('../node_modules/log4js/lib/appenders/console');
	const log4js = require('log4js');

	var pyShell;
	var name = '';
	var logger;

	function ready() {
		ipcRenderer.send('ready', name);
		console.log(name);
	}

	function setupLogger(logPath) {
		log4js.configure({
			appenders: {
				out: {
					type: 'stdout'
				},
				app: {
					type: 'file',
					filename: logPath + '/application.log'
				}
			},
			categories: {
				default: {
					appenders: ['app'],
					level: 'info'
				}
			}
		});

		const logger = log4js.getLogger('app');
		logger.level = 'debug';
		return logger;
	}

	ipcRenderer.on('message', (event, arg) => {
		ipcRenderer.send('for-renderer', 'loud and clear!');
	});

	ipcRenderer.on('pause-script', (event, arg) => {
		logger.info("Pausing script");
		console.log(arg)
		pyShell.send('pause-script');
	});

	ipcRenderer.on('continue-script', (event, arg) => {
		logger.info("Continuing script");
		console.log('continue')
		pyShell.send('continue-script');
	});

	ipcRenderer.on('stop-script', (event, arg) => {
		logger.info("Stopping script");
		pyShell.terminate();
		pyShell.end(function(err) {
			if (err) logger.error(err);
			logger.info('done');
		});
		ready();
	});


	ipcRenderer.on('start', (event, arg) => {
		console.log(arg.scriptDir);
		var scriptName = arg.scriptDir + '/eVOLVER.py';
		var options = {
			mode: 'text',
			args: arg.flag
		};
		pyShell = new PythonShell(scriptName, options);
		console.log('starting expt');
		logger = setupLogger(arg);
		pyShell.on('message', function(message) {
			console.log(message);
			logger.info(message);
		});
		var pid = pyShell.childProcess.pid;
		pyShell.on('close', function() {
			console.log('eVOLVER script with PID ' + pid + ' closed.');
			ipcRenderer.send('close', pid);
			ready();
		});
		ipcRenderer.send('store-pid', [arg.scriptDir, pid]);
	});
	ready();
</script>
